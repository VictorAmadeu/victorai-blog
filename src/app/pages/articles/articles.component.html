<!-- src/app/pages/articles/articles.component.html -->

<!-- 1) Contenedor principal con espaciado vertical -->
<div class="container py-4">

  <!-- 2) Título de la página -->
  <h2 class="mb-4">Artículos</h2>

  <!-- 3) Skeleton loaders mientras loading === true -->
  <ng-container *ngIf="loading; else listContent">
    <!-- Grid de placeholders para mantener el layout -->
    <div class="row g-4">
      <!-- Tres tarjetas esqueleto -->
      <div class="col-md-6 col-lg-4" *ngFor="let n of [1,2,3]">
        <!-- Tarjeta con padding para dibujar bloques skeleton -->
        <div class="card h-100 shadow-sm article-card p-3">
          <!-- Bloque que simula la imagen -->
          <div class="skeleton" style="height:160px; border-radius:10px;"></div>
          <!-- Línea de título simulada -->
          <div class="skeleton mt-3" style="height:18px; width:75%;"></div>
          <!-- Línea de extracto simulada -->
          <div class="skeleton mt-2" style="height:16px; width:55%;"></div>
        </div>
      </div>
    </div>
  </ng-container>

  <!-- 4) Contenido real cuando termina la carga -->
  <ng-template #listContent>

    <!-- 4.1) Estado de error -->
    <div *ngIf="errorMsg" class="alert alert-danger">
      {{ errorMsg }}
    </div>

    <!-- 4.2) Estado vacío -->
    <div *ngIf="!errorMsg && posts.length === 0" class="text-muted">
      No hay artículos todavía.
    </div>

    <!-- 4.3) Grid real de tarjetas -->
    <div class="row g-4" *ngIf="!errorMsg && posts.length > 0">

      <!-- Iteración de posts con trackBy definido en el TS -->
      <div class="col-md-6 col-lg-4" *ngFor="let post of posts; trackBy: trackById">

        <!-- Tarjeta con sombra suave (estilo global .article-card) -->
        <div class="card h-100 shadow-sm article-card">

          <!-- Cuerpo de la tarjeta -->
          <div class="card-body">

            <!-- Badge de categoría con enlace a /categorias/:slug (si existe) -->
            <a
              *ngIf="post.category_slug"
              [routerLink]="['/categorias', post.category_slug]"
              class="badge rounded-pill bg-light text-dark text-decoration-none mb-2 d-inline-block">
              {{ slugToLabel(post.category_slug) }}
            </a>

            <!-- Título del artículo -->
            <h5 class="card-title mb-1">{{ post.title }}</h5>

            <!-- Fecha amigable si viene del backend -->
            <p class="text-muted small mb-3" *ngIf="post.created_at">
              {{ post.created_at | date:'d MMM yyyy' }}
            </p>

            <!-- Extracto limpio (pipe stripMarkdown + slice) -->
            <p class="card-text">
              {{ post.content | stripMarkdown | slice:0:220 }}
              <span *ngIf="(post.content | stripMarkdown).length > 220">…</span>
            </p>

            <!-- (Opcional) Botón a detalle si existe ruta /articulo/:id
            <a [routerLink]="['/articulo', post.id]" class="btn btn-sm btn-outline-primary">
              Leer más
            </a>
            -->
          </div>
          <!-- Fin card-body -->

        </div>
        <!-- Fin card -->

      </div>
      <!-- Fin *ngFor -->

    </div>
    <!-- Fin row -->

  </ng-template>
  <!-- Fin listContent -->

</div>
<!-- Fin container -->
