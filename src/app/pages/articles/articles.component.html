<!-- src/app/pages/articles/articles.component.html -->

<!-- 1) Contenedor principal con espaciado vertical -->
<div class="container py-4">

  <!-- 2) Título de la página -->
  <h2 class="mb-4">Artículos</h2>

  <!-- 3) Estado de carga: se muestra mientras esperamos la respuesta del servicio -->
  <div *ngIf="loading">Cargando…</div>

  <!-- 4) Estado de error: sólo se muestra cuando NO está cargando y hay mensaje de error -->
  <div *ngIf="!loading && errorMsg" class="alert alert-danger">
    {{ errorMsg }}
  </div>

  <!-- 5) Estado vacío: cuando NO está cargando y no hay posts -->
  <div *ngIf="!loading && posts.length === 0" class="text-muted">
    No hay artículos todavía.
  </div>

  <!-- 6) Grid de tarjetas: g-4 = separación entre columnas/filas -->
  <div class="row g-4">

    <!-- 7) Iteramos los posts. Usamos trackById (definido en el TS) para rendimiento -->
    <div class="col-md-6 col-lg-4" *ngFor="let post of posts; trackBy: trackById">

      <!-- 8) Tarjeta con sombra suave (la clase .article-card se define en el SCSS) -->
      <div class="card h-100 shadow-sm article-card">

        <!-- 9) Cuerpo de la tarjeta: badge, título, fecha y extracto -->
        <div class="card-body">

          <!-- 10) Badge de CATEGORÍA con enlace a /categorias/:slug
                   - Sólo se muestra si post.category_slug existe.
                   - El texto del badge usa slugToLabel() para quitar guiones. -->
          <a
            *ngIf="post.category_slug"
            [routerLink]="['/categorias', post.category_slug]"
            class="badge rounded-pill bg-light text-dark text-decoration-none mb-2 d-inline-block"
          >
            {{ slugToLabel(post.category_slug) }}
          </a>

          <!-- 11) Título del artículo -->
          <h5 class="card-title mb-1">{{ post.title }}</h5>

          <!-- 12) Fecha formateada de forma amigable -->
          <p class="text-muted small mb-3" *ngIf="post.created_at">
            {{ post.created_at | date:'d MMM yyyy' }}
          </p>

          <!-- 13) Extracto LIMPIO del contenido (sin sintaxis Markdown)
                   - stripMarkdown → elimina #, **, enlaces, etc.
                   - slice:0:220 → recorta a ~220 caracteres para la tarjeta. -->
          <p class="card-text">
            {{ post.content | stripMarkdown | slice:0:220 }}
            <span *ngIf="(post.content | stripMarkdown).length > 220">…</span>
          </p>

          <!-- 14) (Opcional) Botón "Leer más" si creas la vista de detalle /articulo/:id -->
          <!--
          <a [routerLink]="['/articulo', post.id]" class="btn btn-sm btn-outline-primary">
            Leer más
          </a>
          -->
        </div>
        <!-- 15) Fin card-body -->

      </div>
      <!-- 16) Fin card -->

    </div>
    <!-- 17) Fin *ngFor -->

  </div>
  <!-- 18) Fin row -->

</div>
<!-- 19) Fin container -->
